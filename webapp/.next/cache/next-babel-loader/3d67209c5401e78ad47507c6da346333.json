{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    @media \", \" {\\n        width: 400px;\\n        margin: 10% auto 0 auto;\\n     }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  \", \" {\\n    width: 46px;\\n    cursor: pointer;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useContext } from 'react';\nimport Link from \"next/link\";\nimport Router from 'next/router';\nimport styled, { css } from 'styled-components';\nimport MainProvider, { MainContext, MainConsumer } from \"../components/contextProviders/MainContext\";\nimport { Wrapper } from \"../components/StyledComponents/Wrapper\";\nimport { Button } from \"../components/controls/Button/Button\";\nimport { Divider } from \"../components/StyledComponents/Divider\";\nimport { Close } from '../components/StyledComponents/Icon';\nimport { FlexBlock } from '../components/StyledComponents/FlexBlock';\nimport { Text } from \"../components/StyledComponents/Text\";\nimport { Input } from '../components/controls/Input/Input';\nimport validate from \"../utils/validation\";\nimport { apiLoginUser } from \"../actions/api\";\nimport { showNotification } from \"../utils/notification\";\nimport { auth, login } from \"../utils/auth\";\nimport { initAxios } from \"../config/axios\";\nimport { device } from '../lib/mediaDevice';\nimport { LogoGreen } from '../components/StyledComponents/Icon';\nimport { useDetectDevice } from '../lib/useDetectDevice';\n\nvar LoginPage = function LoginPage() {\n  var _useState = useState(''),\n      email = _useState[0],\n      setEmail = _useState[1];\n\n  var _useState2 = useState(''),\n      password = _useState2[0],\n      setPassword = _useState2[1];\n\n  var _useState3 = useState(false),\n      loading = _useState3[0],\n      setLoading = _useState3[1];\n\n  var _useState4 = useState({}),\n      errors = _useState4[0],\n      setErrors = _useState4[1];\n\n  var currentDevice = useDetectDevice();\n\n  var onChangeEmail = function onChangeEmail(e) {\n    var _e$target = e.target,\n        value = _e$target.value,\n        name = _e$target.name;\n    setEmail(value);\n    var error = validate(name, value, true);\n    setErrors(function (errors) {\n      return _objectSpread({}, errors, _defineProperty({}, name, error));\n    });\n  };\n\n  var onChangePassword = function onChangePassword(e) {\n    var value = e.target.value;\n    setPassword(value);\n  };\n\n  var _useContext = useContext(MainContext),\n      setMe = _useContext.setMe;\n\n  var handleSubmit = function handleSubmit() {\n    setLoading(true);\n    apiLoginUser({\n      email: email.toLowerCase(),\n      password: password\n    }).then(function _callee(res) {\n      var _res$data, token, id;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _res$data = res.data, token = _res$data.token, id = _res$data.id;\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(login({\n                token: token,\n                id: id\n              }));\n\n            case 3:\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(setMe(res.data));\n\n            case 5:\n              // TODO check if is first time\n              initAxios(function () {\n                Router.push('/');\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    })[\"catch\"](function (err) {\n      setLoading(false);\n      showNotification('error', err);\n    });\n  };\n\n  var disabled = loading || !email || !password;\n  return __jsx(LoginWrap, null, __jsx(Wrapper, {\n    p: 25\n  }, __jsx(Wrapper, {\n    mb: 35\n  }, currentDevice.isMobileTablet ? __jsx(Close, {\n    onClick: function onClick() {\n      return Router.back();\n    }\n  }) : __jsx(Link, {\n    href: '/'\n  }, __jsx(LogoGreen, null))), __jsx(FormWrap, null, __jsx(Input, {\n    type: 'text',\n    name: 'email',\n    value: email,\n    onChange: onChangeEmail,\n    placeholder: \"Email address\",\n    error: errors.email,\n    mb: '5px',\n    fz: 15\n  }), __jsx(Input, {\n    type: 'password',\n    value: password,\n    placeholder: \"Password\",\n    onChange: onChangePassword,\n    fz: 15\n  }), __jsx(Button, {\n    green: true,\n    mt: 25,\n    onClick: handleSubmit,\n    disabled: errors.email,\n    loading: loading\n  }, \"Log in\"), __jsx(Divider, {\n    grey: true,\n    full: true,\n    mt: 25,\n    mb: 15\n  }), __jsx(FlexBlock, {\n    right: true\n  }, __jsx(Text, {\n    mr: 10\n  }, \"New to Programmerbooking?\"), __jsx(Link, {\n    href: '/registration'\n  }, __jsx(\"a\", null, __jsx(Text, {\n    isLink: true,\n    textRight: true\n  }, \"Sign up\")))))));\n};\n\nexport default LoginPage;\nvar LoginWrap = styled.div(_templateObject(), LogoGreen);\nvar FormWrap = styled.div(_templateObject2(), device.laptopDesktop);","map":{"version":3,"sources":["D:/4/диплом/webapp — копия/pages/login.js"],"names":["React","useState","useContext","Link","Router","styled","css","MainProvider","MainContext","MainConsumer","Wrapper","Button","Divider","Close","FlexBlock","Text","Input","validate","apiLoginUser","showNotification","auth","login","initAxios","device","LogoGreen","useDetectDevice","LoginPage","email","setEmail","password","setPassword","loading","setLoading","errors","setErrors","currentDevice","onChangeEmail","e","target","value","name","error","onChangePassword","setMe","handleSubmit","toLowerCase","then","res","data","token","id","push","err","disabled","isMobileTablet","back","LoginWrap","div","FormWrap","laptopDesktop"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from 'react';\r\nimport Link from \"next/link\";\r\nimport Router from 'next/router'\r\nimport styled, { css } from 'styled-components'\r\nimport MainProvider, { MainContext, MainConsumer } from \"../components/contextProviders/MainContext\"\r\n\r\nimport {Wrapper} from \"../components/StyledComponents/Wrapper\";\r\nimport {Button} from \"../components/controls/Button/Button\";\r\nimport {Divider} from \"../components/StyledComponents/Divider\";\r\nimport {Close} from '../components/StyledComponents/Icon'\r\nimport {FlexBlock} from '../components/StyledComponents/FlexBlock'\r\nimport {Text} from \"../components/StyledComponents/Text\";\r\nimport {Input} from '../components/controls/Input/Input'\r\nimport validate from \"../utils/validation\";\r\nimport {apiLoginUser} from \"../actions/api\";\r\nimport {showNotification} from \"../utils/notification\";\r\nimport {auth, login} from \"../utils/auth\";\r\nimport {initAxios} from \"../config/axios\";\r\nimport { device } from '../lib/mediaDevice'\r\nimport { LogoGreen } from '../components/StyledComponents/Icon'\r\nimport { useDetectDevice } from '../lib/useDetectDevice'\r\n\r\n\r\n\r\nconst LoginPage = () => {\r\n    const [email, setEmail] = useState('')\r\n    const [password, setPassword] = useState('')\r\n    const [loading, setLoading] = useState(false)\r\n    const [errors, setErrors] = useState({})\r\n    const currentDevice = useDetectDevice()\r\n\r\n    const onChangeEmail = e => {\r\n        let {value, name} = e.target\r\n        setEmail(value)\r\n        let error = validate(name, value, true)\r\n        setErrors((errors) => ({ ...errors, [name]: error }))\r\n    }\r\n    const onChangePassword = e => {\r\n        let {value} = e.target\r\n        setPassword(value)\r\n    }\r\n    const {setMe} = useContext(MainContext)\r\n\r\n    const handleSubmit = () => {\r\n        setLoading(true);\r\n        apiLoginUser({email: email.toLowerCase(), password})\r\n            .then(async res => {\r\n                let {token, id} = res.data;\r\n                await login({ token, id })\r\n                await setMe(res.data)\r\n                // TODO check if is first time\r\n                initAxios(() => {\r\n                    Router.push('/')\r\n                })\r\n\r\n            })\r\n            .catch(err => {\r\n                setLoading(false);\r\n                showNotification('error', err)\r\n            })\r\n    }\r\n\r\n\r\n\r\n    let disabled = loading || !email || !password;\r\n\r\n    return (\r\n        <LoginWrap>\r\n            <Wrapper p={25}>\r\n                <Wrapper mb={35}>\r\n                    {currentDevice.isMobileTablet ?\r\n                        <Close onClick={() => Router.back()} />\r\n                        :\r\n                        <Link href={'/'}>\r\n                            <LogoGreen />\r\n                        </Link>\r\n                    }\r\n\r\n                </Wrapper>\r\n                <FormWrap>\r\n                    <Input type={'text'}\r\n                           name={'email'}\r\n                           value={email}\r\n                           onChange={onChangeEmail}\r\n                           placeholder=\"Email address\"\r\n                           error={errors.email}\r\n                           mb={'5px'}\r\n                           fz={15}\r\n                    />\r\n                    <Input type={'password'}\r\n                           value={password}\r\n                           placeholder=\"Password\"\r\n                           onChange={onChangePassword}\r\n                           fz={15}\r\n                    />\r\n                    <Button green mt={25} onClick={handleSubmit} disabled={errors.email} loading={loading} >Log in</Button>\r\n                    <Divider grey full mt={25} mb={15} />\r\n                    <FlexBlock right>\r\n                        <Text mr={10} >New to Programmerbooking?</Text>\r\n                        <Link href={'/registration'}>\r\n                            <a><Text isLink textRight >Sign up</Text></a>\r\n                        </Link>\r\n                    </FlexBlock>\r\n                </FormWrap>\r\n                \r\n            </Wrapper>\r\n\r\n        </LoginWrap>\r\n    );\r\n};\r\n\r\nexport default LoginPage;\r\n\r\nconst LoginWrap = styled.div`\r\n  ${LogoGreen} {\r\n    width: 46px;\r\n    cursor: pointer;\r\n  }\r\n`\r\nconst FormWrap = styled.div`\r\n    @media ${device.laptopDesktop} {\r\n        width: 400px;\r\n        margin: 10% auto 0 auto;\r\n     }\r\n`\r\n"]},"metadata":{},"sourceType":"module"}