{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport axios from 'axios';\nimport { Provider } from 'react-redux';\nimport { createStore, declareAction, declareAtom } from '@reatom/core';\nimport { context } from '@reatom/react';\nimport App from 'next/app';\nimport { store } from '../features/index';\nexport var withReatom = function withReatom(PageComponent) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$ssr = _ref.ssr,\n      ssr = _ref$ssr === void 0 ? true : _ref$ssr;\n\n  var WithReatom = function WithReatom(_ref2) {\n    var props = _extends({}, _ref2);\n\n    // let store = getOrInitializeStore(store)\n    return __jsx(context.Provider, {\n      value: store\n    }, __jsx(PageComponent, props));\n  }; // Make sure people don't use this HOC on _app.js level\n\n\n  if (true) {\n    var isAppHoc = PageComponent === App || PageComponent.prototype instanceof App;\n\n    if (isAppHoc) {\n      throw new Error('The withRedux HOC only works with PageComponents');\n    }\n  } // Set the correct displayName in development\n\n\n  if (true) {\n    var displayName = PageComponent.displayName || PageComponent.name || 'Component';\n    WithReatom.displayName = \"withReatom(\".concat(displayName, \")\");\n  }\n\n  if (ssr || PageComponent.getInitialProps) {\n    WithReatom.getInitialProps = function _callee(context) {\n      var pageProps;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // Get or Create the store with `undefined` as initialState\n              // This allows you to set a custom default initialState\n              // Provide the store to getInitialProps of pages\n              context.reatomStore = store; // Run getInitialProps from HOCed PageComponent\n\n              if (!(typeof PageComponent.getInitialProps === 'function')) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(PageComponent.getInitialProps(context));\n\n            case 4:\n              _context.t0 = _context.sent;\n              _context.next = 8;\n              break;\n\n            case 7:\n              _context.t0 = {};\n\n            case 8:\n              pageProps = _context.t0;\n              return _context.abrupt(\"return\", _objectSpread({}, pageProps));\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    };\n  }\n\n  return WithReatom;\n};\nvar reatomStore;\n\nvar getOrInitializeStore = function getOrInitializeStore(initialState) {\n  // Always make a new store if server, otherwise state is shared between requests\n  if (false) {\n    return store;\n  } // Create store if unavailable on the client and set it on the window object\n\n\n  if (!reatomStore) {\n    reatomStore = store;\n  }\n\n  return store;\n};","map":{"version":3,"sources":["D:/git/webapp3/webapp/lib/withReatom.js"],"names":["React","axios","Provider","createStore","declareAction","declareAtom","context","App","store","withReatom","PageComponent","ssr","WithReatom","props","isAppHoc","prototype","Error","displayName","name","getInitialProps","reatomStore","pageProps","getOrInitializeStore","initialState"],"mappings":";;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,QAAyB,aAAzB;AACA,SAAQC,WAAR,EAAqBC,aAArB,EAAoCC,WAApC,QAAsD,cAAtD;AACA,SAASC,OAAT,QAAwB,eAAxB;AACA,OAAOC,GAAP,MAAgB,UAAhB;AAEA,SAAQC,KAAR,QAAoB,mBAApB;AAEA,OAAO,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACC,aAAD,EAAwC;AAAA,iFAAP,EAAO;AAAA,sBAAtBC,GAAsB;AAAA,MAAtBA,GAAsB,yBAAhB,IAAgB;;AAC9D,MAAMC,UAAU,GAAG,SAAbA,UAAa,QAAiB;AAAA,QAAZC,KAAY;;AAChC;AACA,WACI,MAAC,OAAD,CAAS,QAAT;AAAkB,MAAA,KAAK,EAAEL;AAAzB,OACI,MAAC,aAAD,EAAmBK,KAAnB,CADJ,CADJ;AAKH,GAPD,CAD8D,CAU9D;;;AACA,YAA2C;AACvC,QAAMC,QAAQ,GACVJ,aAAa,KAAKH,GAAlB,IAAyBG,aAAa,CAACK,SAAd,YAAmCR,GADhE;;AAEA,QAAIO,QAAJ,EAAc;AACV,YAAM,IAAIE,KAAJ,CAAU,kDAAV,CAAN;AACH;AACJ,GAjB6D,CAmB9D;;;AACA,YAA2C;AACvC,QAAMC,WAAW,GACbP,aAAa,CAACO,WAAd,IAA6BP,aAAa,CAACQ,IAA3C,IAAmD,WADvD;AAGAN,IAAAA,UAAU,CAACK,WAAX,wBAAuCA,WAAvC;AACH;;AAED,MAAIN,GAAG,IAAID,aAAa,CAACS,eAAzB,EAA0C;AACtCP,IAAAA,UAAU,CAACO,eAAX,GAA6B,iBAAMb,OAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACzB;AACA;AAEA;AACAA,cAAAA,OAAO,CAACc,WAAR,GAAsBZ,KAAtB,CALyB,CAOzB;;AAPyB,oBASrB,OAAOE,aAAa,CAACS,eAArB,KAAyC,UATpB;AAAA;AAAA;AAAA;;AAAA;AAAA,+CAUTT,aAAa,CAACS,eAAd,CAA8Bb,OAA9B,CAVS;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,4BAWf,EAXe;;AAAA;AAQnBe,cAAAA,SARmB;AAAA,iEAelBA,SAfkB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA7B;AAmBH;;AAED,SAAOT,UAAP;AACH,CAlDM;AAsDP,IAAIQ,WAAJ;;AACA,IAAME,oBAAoB,GAAG,SAAvBA,oBAAuB,CAAAC,YAAY,EAAI;AACzC;AACA,aAAmC;AAC/B,WAAOf,KAAP;AACH,GAJwC,CAMzC;;;AACA,MAAI,CAACY,WAAL,EAAkB;AACdA,IAAAA,WAAW,GAAGZ,KAAd;AACH;;AAED,SAAOA,KAAP;AACH,CAZD","sourcesContent":["import React from 'react'\r\nimport axios from 'axios'\r\nimport { Provider } from 'react-redux'\r\nimport {createStore, declareAction, declareAtom} from '@reatom/core'\r\nimport { context } from '@reatom/react'\r\nimport App from 'next/app'\r\n\r\nimport {store} from '../features/index'\r\n\r\nexport const withReatom = (PageComponent, { ssr = true } = {}) => {\r\n    const WithReatom = ({...props }) => {\r\n        // let store = getOrInitializeStore(store)\r\n        return (\r\n            <context.Provider value={store}>\r\n                <PageComponent {...props} />\r\n            </context.Provider>\r\n        )\r\n    }\r\n\r\n    // Make sure people don't use this HOC on _app.js level\r\n    if (process.env.NODE_ENV !== 'production') {\r\n        const isAppHoc =\r\n            PageComponent === App || PageComponent.prototype instanceof App\r\n        if (isAppHoc) {\r\n            throw new Error('The withRedux HOC only works with PageComponents')\r\n        }\r\n    }\r\n\r\n    // Set the correct displayName in development\r\n    if (process.env.NODE_ENV !== 'production') {\r\n        const displayName =\r\n            PageComponent.displayName || PageComponent.name || 'Component'\r\n\r\n        WithReatom.displayName = `withReatom(${displayName})`\r\n    }\r\n\r\n    if (ssr || PageComponent.getInitialProps) {\r\n        WithReatom.getInitialProps = async context => {\r\n            // Get or Create the store with `undefined` as initialState\r\n            // This allows you to set a custom default initialState\r\n\r\n            // Provide the store to getInitialProps of pages\r\n            context.reatomStore = store\r\n\r\n            // Run getInitialProps from HOCed PageComponent\r\n            const pageProps =\r\n                typeof PageComponent.getInitialProps === 'function'\r\n                    ? await PageComponent.getInitialProps(context)\r\n                    : {}\r\n\r\n            // Pass props to PageComponent\r\n            return {\r\n                ...pageProps\r\n                // initialReatomState: reatomStore.getState(),\r\n            }\r\n        }\r\n    }\r\n\r\n    return WithReatom\r\n}\r\n\r\n\r\n\r\nlet reatomStore\r\nconst getOrInitializeStore = initialState => {\r\n    // Always make a new store if server, otherwise state is shared between requests\r\n    if (typeof window === 'undefined') {\r\n        return store\r\n    }\r\n\r\n    // Create store if unavailable on the client and set it on the window object\r\n    if (!reatomStore) {\r\n        reatomStore = store\r\n    }\r\n\r\n    return store\r\n}"]},"metadata":{},"sourceType":"module"}