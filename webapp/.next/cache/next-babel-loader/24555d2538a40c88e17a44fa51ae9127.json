{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useContext, useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport moment from 'moment';\nimport { MainContext } from '../../../components/contextProviders/MainContext';\nimport Discounts from '../../../components/Offer/discounts/Discounts';\nimport Based from '../../../components/Offer/discounts/Based';\nimport LocalLaws from '../../../components/Offer/discounts/LocalLaws';\nimport { Wrapper, WrapperHeight } from '../../../components/StyledComponents/Wrapper';\nimport { Button } from '../../../components/controls/Button/Button';\nimport { Footer } from '../../../components/Layouts/styledLayouts';\nimport Header from '../../../components/Header/Header';\nimport withOfferInfo from '../../../utils/offer';\nimport { apiOfferCreateDiscounts, apiEditOffer } from '../../../actions/api';\nimport { showNotification } from '../../../utils/notification';\nimport useOffer from '../../../hooks/useOffer';\nimport HowSetPrice from '../../../components/Offer/price/HowSetPrice';\nimport BasePrice from '../../../components/Offer/price/BasePrice';\nimport KickstartPrice from '../../../components/Offer/price/KickstartPrice';\nimport { ContainerDesktop, FooterDesktop } from '../../../components/StyledComponents/Grid';\nimport styled from 'styled-components';\nimport { device } from '../../../lib/mediaDevice';\n\nvar DiscountsPage = function DiscountsPage() {\n  var router = useRouter();\n  var id = router.query.id;\n  var offer = useOffer(id);\n\n  var _useContext = useContext(MainContext),\n      setOffer = _useContext.setOffer;\n\n  var _useState = useState(1),\n      step = _useState[0],\n      setStep = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState({\n    nD3: '',\n    nD7: '',\n    nD28: ''\n  }),\n      discounts = _useState3[0],\n      setDiscounts = _useState3[1];\n\n  console.log(offer);\n  useEffect(function () {\n    if (offer.id) {\n      if (offer.discounts && offer.discounts.length) {\n        var defaultDiscount = {\n          nD3: offer.discounts[0].discount || '',\n          nD7: offer.discounts[1].discount || '',\n          nD28: offer.discounts[2].discount || ''\n        };\n        setDiscounts(defaultDiscount);\n      }\n    }\n  }, [offer.id]);\n\n  var handleChangeStep = function handleChangeStep(i) {\n    if (step === 1 && i === -1) {\n      Router.push('/offers/[id]/price', \"/offers/\".concat(id, \"/price\"), {\n        shallow: true\n      });\n      return;\n    }\n\n    if (step === 3 && i === 1) {\n      createDiscounts();\n    } else {\n      setStep(step + i);\n    }\n  };\n\n  var onChange = function onChange(obj) {\n    var name = obj.name,\n        value = obj.value;\n    setDiscounts(function (discounts) {\n      return _objectSpread({}, discounts, _defineProperty({}, name, value));\n    });\n  };\n\n  var createDiscounts = function createDiscounts() {\n    var clone = _objectSpread({}, discounts);\n\n    clone.offerId = id;\n    clone.discounts = [{\n      numberDays: 3,\n      discount: clone.nD3\n    }, {\n      numberDays: 7,\n      discount: clone.nD7\n    }, {\n      numberDays: 28,\n      discount: clone.nD28\n    }];\n    setLoading(true);\n    apiEditOffer(id, {\n      step: 7\n    });\n    apiOfferCreateDiscounts(clone).then(function (res) {\n      setLoading(false);\n      if (res.err) return;\n      setOffer(_objectSpread({}, offer, {\n        discounts: res.data.discounts\n      }));\n      Router.push('/offers/[id]/congratulations', \"/offers/\".concat(id, \"/congratulations\"), {\n        shallow: true\n      });\n    })[\"catch\"](function (e) {\n      setLoading(false);\n      showNotification('error', e);\n    });\n  };\n\n  var disabled = loading;\n  var startDate = moment(offer.startDate).format('DD MMMM');\n  return __jsx(React.Fragment, null, __jsx(Header, {\n    isReg: true\n  }), __jsx(Wrapper, {\n    p: 17,\n    pt: 35\n  }, offer.id ? __jsx(React.Fragment, null, __jsx(ContainerDesktop, {\n    isOffer: true\n  }, __jsx(WrapperHeight, null, step === 1 && __jsx(Discounts, {\n    discounts: discounts,\n    onChange: onChange\n  }), step === 2 && __jsx(Based, {\n    discounts: discounts,\n    startDate: startDate,\n    onChange: onChange\n  }), step === 3 && __jsx(LocalLaws, {\n    discounts: discounts,\n    onChange: onChange\n  }))), __jsx(FooterDesktop, null, __jsx(Footer, {\n    mt: 30\n  }, step !== 3 && __jsx(Button, {\n    onClick: function onClick() {\n      return handleChangeStep(-1);\n    }\n  }, \"Back\"), __jsx(Button, {\n    blue: true,\n    onClick: function onClick() {\n      return handleChangeStep(1);\n    },\n    loading: loading,\n    w100: step === 3\n  }, step === 3 ? 'Agrees and continue' : 'Next')))) : __jsx(React.Fragment, null, \"Loading...\")));\n};\n\nexport default DiscountsPage;","map":{"version":3,"sources":["D:/4/диплом/webapp — копия/pages/offers/[id]/discounts.js"],"names":["React","useState","useContext","useEffect","Router","useRouter","moment","MainContext","Discounts","Based","LocalLaws","Wrapper","WrapperHeight","Button","Footer","Header","withOfferInfo","apiOfferCreateDiscounts","apiEditOffer","showNotification","useOffer","HowSetPrice","BasePrice","KickstartPrice","ContainerDesktop","FooterDesktop","styled","device","DiscountsPage","router","id","query","offer","setOffer","step","setStep","loading","setLoading","nD3","nD7","nD28","discounts","setDiscounts","console","log","length","defaultDiscount","discount","handleChangeStep","i","push","shallow","createDiscounts","onChange","obj","name","value","clone","offerId","numberDays","then","res","err","data","e","disabled","startDate","format"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\r\nimport Router, { useRouter } from 'next/router'\r\nimport moment from 'moment'\r\nimport { MainContext } from '../../../components/contextProviders/MainContext'\r\n\r\nimport Discounts from '../../../components/Offer/discounts/Discounts'\r\nimport Based from '../../../components/Offer/discounts/Based'\r\nimport LocalLaws from '../../../components/Offer/discounts/LocalLaws'\r\nimport { Wrapper, WrapperHeight } from '../../../components/StyledComponents/Wrapper'\r\nimport { Button } from '../../../components/controls/Button/Button'\r\nimport { Footer } from '../../../components/Layouts/styledLayouts'\r\nimport Header from '../../../components/Header/Header'\r\nimport withOfferInfo from '../../../utils/offer'\r\nimport { apiOfferCreateDiscounts, apiEditOffer } from '../../../actions/api'\r\nimport { showNotification } from '../../../utils/notification'\r\nimport useOffer from '../../../hooks/useOffer'\r\nimport HowSetPrice from '../../../components/Offer/price/HowSetPrice'\r\nimport BasePrice from '../../../components/Offer/price/BasePrice'\r\nimport KickstartPrice from '../../../components/Offer/price/KickstartPrice'\r\nimport { ContainerDesktop, FooterDesktop } from '../../../components/StyledComponents/Grid'\r\nimport styled from 'styled-components'\r\nimport { device } from '../../../lib/mediaDevice'\r\n\r\nconst DiscountsPage = () => {\r\n  const router = useRouter()\r\n  const { id } = router.query\r\n  const offer = useOffer(id)\r\n  const { setOffer } = useContext(MainContext)\r\n  const [step, setStep] = useState(1)\r\n  const [loading, setLoading] = useState(false)\r\n  const [discounts, setDiscounts] = useState({\r\n    nD3: '',\r\n    nD7: '',\r\n    nD28: '',\r\n  })\r\n\r\n  console.log(offer)\r\n\r\n  useEffect(() => {\r\n    if (offer.id) {\r\n      if (offer.discounts && offer.discounts.length) {\r\n        let defaultDiscount = {\r\n          nD3: offer.discounts[0].discount || '',\r\n          nD7: offer.discounts[1].discount || '',\r\n          nD28: offer.discounts[2].discount || '',\r\n        }\r\n        setDiscounts(defaultDiscount)\r\n      }\r\n    }\r\n  }, [offer.id])\r\n\r\n  const handleChangeStep = (i) => {\r\n    if (step === 1 && i === -1) {\r\n      Router.push('/offers/[id]/price', `/offers/${id}/price`, { shallow: true })\r\n      return\r\n    }\r\n    if (step === 3 && i === 1) {\r\n      createDiscounts()\r\n    } else {\r\n      setStep(step + i)\r\n    }\r\n  }\r\n\r\n  const onChange = (obj) => {\r\n    let { name, value } = obj\r\n    setDiscounts((discounts) => ({ ...discounts, [name]: value }))\r\n  }\r\n\r\n  const createDiscounts = () => {\r\n    const clone = { ...discounts }\r\n    clone.offerId = id\r\n    clone.discounts = [\r\n      {\r\n        numberDays: 3,\r\n        discount: clone.nD3,\r\n      },\r\n      {\r\n        numberDays: 7,\r\n        discount: clone.nD7,\r\n      },\r\n      {\r\n        numberDays: 28,\r\n        discount: clone.nD28,\r\n      },\r\n    ]\r\n\r\n    setLoading(true)\r\n    apiEditOffer(id, { step: 7 })\r\n    apiOfferCreateDiscounts(clone)\r\n      .then((res) => {\r\n        setLoading(false)\r\n        if (res.err) return\r\n        setOffer({ ...offer, discounts: res.data.discounts })\r\n        Router.push('/offers/[id]/congratulations', `/offers/${id}/congratulations`, {\r\n          shallow: true,\r\n        })\r\n      })\r\n      .catch((e) => {\r\n        setLoading(false)\r\n        showNotification('error', e)\r\n      })\r\n  }\r\n\r\n  const disabled = loading\r\n  const startDate = moment(offer.startDate).format('DD MMMM')\r\n\r\n  return (\r\n    <>\r\n      <Header isReg />\r\n      <Wrapper p={17} pt={35}>\r\n        {offer.id ? (\r\n          <>\r\n            <ContainerDesktop isOffer>\r\n              <WrapperHeight>\r\n                {step === 1 && <Discounts discounts={discounts} onChange={onChange} />}\r\n                {step === 2 && (\r\n                  <Based discounts={discounts} startDate={startDate} onChange={onChange} />\r\n                )}\r\n                {step === 3 && <LocalLaws discounts={discounts} onChange={onChange} />}\r\n              </WrapperHeight>\r\n            </ContainerDesktop>\r\n\r\n            <FooterDesktop>\r\n              <Footer mt={30}>\r\n                {step !== 3 && <Button onClick={() => handleChangeStep(-1)}>Back</Button>}\r\n                <Button\r\n                  blue\r\n                  onClick={() => handleChangeStep(1)}\r\n                  loading={loading}\r\n                  w100={step === 3}\r\n                >\r\n                  {step === 3 ? 'Agrees and continue' : 'Next'}\r\n                </Button>\r\n              </Footer>\r\n            </FooterDesktop>\r\n          </>\r\n        ) : (\r\n          <>Loading...</>\r\n        )}\r\n      </Wrapper>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default DiscountsPage\r\n"]},"metadata":{},"sourceType":"module"}