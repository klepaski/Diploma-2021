{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useContext, useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport { MainContext } from '../../../components/contextProviders/MainContext';\nimport BasePrice from \"../../../components/Offer/price/BasePrice\";\nimport { Wrapper, WrapperHeight } from '../../../components/StyledComponents/Wrapper';\nimport { Button } from '../../../components/controls/Button/Button';\nimport { Footer } from '../../../components/Layouts/styledLayouts';\nimport Header from '../../../components/Header/Header';\nimport { apiEditOffer, apiOfferCreatePrice } from '../../../actions/api';\nimport withOfferInfo from '../../../utils/offer';\nimport useOffer from '../../../hooks/useOffer';\nimport { ContainerDesktop, FooterDesktop } from '../../../components/StyledComponents/Grid';\nimport styled from 'styled-components';\nimport { device } from '../../../lib/mediaDevice';\n\nvar PricePage = function PricePage() {\n  var router = useRouter();\n  var id = router.query.id;\n  var offer = useOffer(id);\n\n  var _useContext = useContext(MainContext),\n      setOffer = _useContext.setOffer;\n\n  var _useState = useState(1),\n      step = _useState[0],\n      setStep = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState({\n    typePrice: 'fixed',\n    pricePerAct: '',\n    currency: '$',\n    kickstart: '15'\n  }),\n      price = _useState3[0],\n      setPrice = _useState3[1];\n\n  console.log('offer', offer);\n  useEffect(function () {\n    if (offer.id && offer.typePrice) {\n      var _price = {\n        typePrice: offer.typePrice,\n        pricePerAct: offer.pricePerAct,\n        currency: offer.currency || 'AED',\n        kickstart: offer.kickstart\n      };\n      setPrice(_price);\n    }\n  }, [offer.id]);\n\n  var handleChangeStep = function handleChangeStep(i) {\n    if (step === 1 && i === -1) {\n      Router.push('/offers/[id]/calendar', \"/offers/\".concat(id, \"/calendar\"), {\n        shallow: true\n      });\n      return;\n    }\n\n    if (step === 1 && i === 1) {\n      createPrice();\n    } else {\n      setStep(step + i);\n    }\n  };\n\n  var onChange = function onChange(obj) {\n    var type = obj.type,\n        value = obj.value;\n    setPrice(function (price) {\n      return _objectSpread({}, price, _defineProperty({}, type, value));\n    });\n  };\n\n  var createPrice = function createPrice() {\n    var clone = _objectSpread({}, price);\n\n    clone.offerId = id; // clone.eventId = offer.eventId;\n\n    setLoading(true);\n    apiEditOffer(id, {\n      step: 6\n    });\n    apiOfferCreatePrice(clone).then(function (res) {\n      setLoading(false);\n      if (res.err) return;\n      setOffer(_objectSpread({}, offer, {\n        typePrice: res.data.typePrice,\n        pricePerAct: res.data.pricePerAct,\n        currency: res.data.currency,\n        kickstart: res.data.kickstart\n      }));\n      Router.push('/offers/[id]/congratulations', \"/offers/\".concat(id, \"/congratulations\"), {\n        shallow: true\n      });\n    });\n  };\n\n  var disabled = step === 1 && !price.pricePerAct;\n  return __jsx(React.Fragment, null, __jsx(Header, {\n    isReg: true\n  }), __jsx(Wrapper, {\n    p: 17,\n    pt: 35\n  }, offer.id ? __jsx(React.Fragment, null, __jsx(ContainerDesktop, {\n    isOffer: true\n  }, __jsx(WrapperHeight, null, step === 1 && __jsx(BasePrice, {\n    price: price,\n    onChange: onChange\n  }))), __jsx(FooterDesktop, null, __jsx(Footer, {\n    mt: 30\n  }, __jsx(Button, {\n    onClick: function onClick() {\n      return handleChangeStep(-1);\n    }\n  }, \"Back\"), __jsx(Button, {\n    blue: true,\n    onClick: function onClick() {\n      return handleChangeStep(1);\n    },\n    loading: loading,\n    disabled: disabled\n  }, \"Next\")))) : __jsx(React.Fragment, null, \"Loading...\")));\n};\n\nexport default PricePage;","map":{"version":3,"sources":["D:/4/диплом/webapp — копия/pages/offers/[id]/price.js"],"names":["React","useState","useContext","useEffect","Router","useRouter","MainContext","BasePrice","Wrapper","WrapperHeight","Button","Footer","Header","apiEditOffer","apiOfferCreatePrice","withOfferInfo","useOffer","ContainerDesktop","FooterDesktop","styled","device","PricePage","router","id","query","offer","setOffer","step","setStep","loading","setLoading","typePrice","pricePerAct","currency","kickstart","price","setPrice","console","log","handleChangeStep","i","push","shallow","createPrice","onChange","obj","type","value","clone","offerId","then","res","err","data","disabled"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\r\nimport Router, { useRouter } from 'next/router'\r\nimport { MainContext } from '../../../components/contextProviders/MainContext'\r\n\r\nimport BasePrice from \"../../../components/Offer/price/BasePrice\";\r\nimport { Wrapper, WrapperHeight } from '../../../components/StyledComponents/Wrapper'\r\nimport { Button } from '../../../components/controls/Button/Button'\r\nimport { Footer } from '../../../components/Layouts/styledLayouts'\r\nimport Header from '../../../components/Header/Header'\r\nimport { apiEditOffer, apiOfferCreatePrice } from '../../../actions/api'\r\nimport withOfferInfo from '../../../utils/offer'\r\nimport useOffer from '../../../hooks/useOffer'\r\nimport { ContainerDesktop, FooterDesktop } from '../../../components/StyledComponents/Grid'\r\nimport styled from 'styled-components'\r\nimport { device } from '../../../lib/mediaDevice'\r\n\r\nconst PricePage = () => {\r\n  const router = useRouter()\r\n  const { id } = router.query\r\n  const offer = useOffer(id)\r\n  const { setOffer } = useContext(MainContext)\r\n  const [step, setStep] = useState(1)\r\n  const [loading, setLoading] = useState(false)\r\n  const [price, setPrice] = useState({\r\n    typePrice: 'fixed',\r\n    pricePerAct: '',\r\n    currency: '$',\r\n    kickstart: '15',\r\n  })\r\n\r\n  console.log('offer', offer)\r\n\r\n  useEffect(() => {\r\n    if (offer.id && offer.typePrice) {\r\n      let price = {\r\n        typePrice: offer.typePrice,\r\n        pricePerAct: offer.pricePerAct,\r\n        currency: offer.currency || 'AED',\r\n        kickstart: offer.kickstart,\r\n      }\r\n      setPrice(price)\r\n    }\r\n  }, [offer.id])\r\n\r\n  const handleChangeStep = (i) => {\r\n    if (step === 1 && i === -1) {\r\n      Router.push('/offers/[id]/calendar', `/offers/${id}/calendar`, { shallow: true })\r\n      return\r\n    }\r\n    if (step === 1 && i === 1) {\r\n      createPrice()\r\n    } else {\r\n      setStep(step + i)\r\n    }\r\n  }\r\n\r\n  const onChange = (obj) => {\r\n    let { type, value } = obj\r\n    setPrice((price) => ({ ...price, [type]: value }))\r\n  }\r\n\r\n  const createPrice = () => {\r\n    const clone = { ...price }\r\n    clone.offerId = id\r\n    // clone.eventId = offer.eventId;\r\n    setLoading(true)\r\n    apiEditOffer(id, { step: 6 })\r\n    apiOfferCreatePrice(clone).then((res) => {\r\n      setLoading(false)\r\n      if (res.err) return\r\n      setOffer({\r\n        ...offer,\r\n        typePrice: res.data.typePrice,\r\n        pricePerAct: res.data.pricePerAct,\r\n        currency: res.data.currency,\r\n        kickstart: res.data.kickstart,\r\n      })\r\n      Router.push('/offers/[id]/congratulations', `/offers/${id}/congratulations`, {shallow: true})\r\n    })\r\n  }\r\n\r\n  const disabled = step === 1 && !price.pricePerAct\r\n\r\n  return (\r\n    <>\r\n      <Header isReg />\r\n      <Wrapper p={17} pt={35}>\r\n        {offer.id ? (\r\n          <>\r\n              <ContainerDesktop isOffer>\r\n                  <WrapperHeight>\r\n                      {step === 1 && <BasePrice price={price} onChange={onChange} />}\r\n                  </WrapperHeight>\r\n              </ContainerDesktop>\r\n\r\n              <FooterDesktop>\r\n                  <Footer mt={30}>\r\n                      <Button onClick={() => handleChangeStep(-1)}>Back</Button>\r\n                      <Button\r\n                          blue\r\n                          onClick={() => handleChangeStep(1)}\r\n                          loading={loading}\r\n                          disabled={disabled}\r\n                      >\r\n                          Next\r\n                      </Button>\r\n                  </Footer>\r\n              </FooterDesktop>\r\n\r\n          </>\r\n        ) : (\r\n          <>Loading...</>\r\n        )}\r\n      </Wrapper>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default PricePage\r\n\r\n"]},"metadata":{},"sourceType":"module"}