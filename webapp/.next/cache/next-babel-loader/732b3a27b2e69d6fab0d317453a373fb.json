{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _objectDestructuringEmpty from \"@babel/runtime-corejs2/helpers/esm/objectDestructuringEmpty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useContext, useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport LastStep from '../../../components/Offer/regulations/LastStep';\nimport { Wrapper, WrapperHeight } from \"../../../components/StyledComponents/Wrapper\";\nimport { Button } from \"../../../components/controls/Button/Button\";\nimport { Footer } from \"../../../components/Layouts/styledLayouts\";\nimport { apiEditOffer, apiOfferRegulations } from '../../../actions/api';\nimport Header from \"../../../components/Header/Header\";\nimport useOffer from \"../../../hooks/useOffer\";\nimport { MainContext } from \"../../../components/contextProviders/MainContext\";\nimport { ContainerDesktop, FooterDesktop } from \"../../../components/StyledComponents/Grid\";\nimport styled from \"styled-components\";\nimport { device } from \"../../../lib/mediaDevice\";\n\nvar RegulationsPage = function RegulationsPage(_ref) {\n  _objectDestructuringEmpty(_ref);\n\n  var router = useRouter();\n  var id = router.query.id;\n  var offer = useOffer(id);\n\n  var _useContext = useContext(MainContext),\n      setOffer = _useContext.setOffer;\n\n  var _useState = useState(1),\n      step = _useState[0],\n      setStep = _useState[1];\n\n  var _useState2 = useState({\n    regulations: [],\n    details: [{\n      title: 'Using fire',\n      value: false\n    }, {\n      title: 'Load music',\n      value: false\n    }, {\n      title: 'Censored',\n      value: false\n    }]\n  }),\n      info = _useState2[0],\n      setInfo = _useState2[1];\n\n  var _useState3 = useState(false),\n      loading = _useState3[0],\n      setLoading = _useState3[1];\n\n  console.log(offer);\n  useEffect(function () {\n    window.scrollTo(0, 0);\n  }, [step]);\n\n  var handleChangeStep = function handleChangeStep(i) {\n    if (step === 1 && i === -1) {\n      Router.push('/offers/[id]/photos', \"/offers/\".concat(id, \"/photos\"), {\n        shallow: true\n      });\n      return;\n    }\n\n    if (step === 1 && i === 1) {\n      createRegulations();\n    } else {\n      setStep(step + i);\n    }\n  };\n\n  var onChange = function onChange(obj) {\n    var type = obj.type,\n        value = obj.value;\n    setInfo(function (info) {\n      return _objectSpread({}, info, _defineProperty({}, type, value));\n    });\n  };\n\n  var createRegulations = function createRegulations() {\n    var data = {};\n    data.offerId = id;\n    data.regulations = info.regulations.filter(function (item) {\n      return item.value;\n    }).map(function (item) {\n      return item.value ? item.title : null;\n    });\n    data.details = info.details.filter(function (item) {\n      return item.value;\n    }).map(function (item) {\n      return item.value ? item.title : null;\n    });\n    setLoading(true);\n    apiEditOffer(id, {\n      step: 3\n    });\n    setOffer(_objectSpread({}, offer, {\n      step: 3\n    }));\n    apiOfferRegulations(data).then(function (res) {\n      if (res.err) {\n        setLoading(false);\n        return;\n      }\n\n      Router.push('/offers/[id]/performance-details', \"/offers/\".concat(id, \"/performance-details\"), {\n        shallow: true\n      });\n    });\n  };\n\n  return __jsx(React.Fragment, null, __jsx(Header, {\n    isReg: true\n  }), __jsx(Wrapper, {\n    p: 17,\n    pt: 35\n  }, offer.id ? __jsx(React.Fragment, null, __jsx(ContainerDesktop, {\n    isOffer: true\n  }, __jsx(WrapperHeight, null, step === 1 && __jsx(LastStep, {\n    offer: offer,\n    handleChangeStep: handleChangeStep\n  }))), step !== 1 && __jsx(FooterDesktop, null, __jsx(Footer, {\n    mt: 30,\n    flexEnd: step === 1\n  }, step !== 1 && __jsx(Button, {\n    onClick: function onClick() {\n      return handleChangeStep(-1);\n    }\n  }, \"Back\"), __jsx(Button, {\n    blue: true,\n    onClick: function onClick() {\n      return handleChangeStep(1);\n    },\n    loading: loading\n  }, \"Next\")))) : __jsx(React.Fragment, null, \"Loading...\")));\n};\n\nexport default RegulationsPage;","map":{"version":3,"sources":["D:/4/диплом/webapp — копия/pages/offers/[id]/regulations.js"],"names":["React","useState","useContext","useEffect","Router","useRouter","LastStep","Wrapper","WrapperHeight","Button","Footer","apiEditOffer","apiOfferRegulations","Header","useOffer","MainContext","ContainerDesktop","FooterDesktop","styled","device","RegulationsPage","router","id","query","offer","setOffer","step","setStep","regulations","details","title","value","info","setInfo","loading","setLoading","console","log","window","scrollTo","handleChangeStep","i","push","shallow","createRegulations","onChange","obj","type","data","offerId","filter","item","map","then","res","err"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\r\nimport Router, { useRouter } from 'next/router'\r\n\r\nimport LastStep from '../../../components/Offer/regulations/LastStep'\r\nimport {Wrapper, WrapperHeight} from \"../../../components/StyledComponents/Wrapper\";\r\nimport {Button} from \"../../../components/controls/Button/Button\";\r\nimport {Footer} from \"../../../components/Layouts/styledLayouts\";\r\nimport {apiEditOffer, apiOfferRegulations} from '../../../actions/api'\r\nimport Header from \"../../../components/Header/Header\";\r\nimport useOffer from \"../../../hooks/useOffer\";\r\nimport {MainContext} from \"../../../components/contextProviders/MainContext\";\r\nimport {ContainerDesktop, FooterDesktop} from \"../../../components/StyledComponents/Grid\";\r\nimport styled from \"styled-components\";\r\nimport {device} from \"../../../lib/mediaDevice\";\r\n\r\n\r\n\r\nconst RegulationsPage = ({}) => {\r\n    const router = useRouter()\r\n    const {id} = router.query\r\n    const offer = useOffer(id)\r\n    const {setOffer} = useContext(MainContext)\r\n    const [step, setStep] = useState(1)\r\n    const [info, setInfo] = useState( {\r\n        regulations: [\r\n\r\n        ],\r\n        details: [\r\n            {title: 'Using fire', value: false},\r\n            {title: 'Load music', value: false},\r\n            {title: 'Censored', value: false}\r\n        ]\r\n    })\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    console.log(offer)\r\n\r\n    useEffect(() => {\r\n        window.scrollTo(0, 0)\r\n    }, [step])\r\n\r\n    const handleChangeStep = (i) => {\r\n        if(step === 1 && i === -1) {\r\n            Router.push('/offers/[id]/photos', `/offers/${id}/photos`, {shallow: true})\r\n            return;\r\n        }\r\n        if(step === 1 && i === 1) {\r\n            createRegulations()\r\n        } else {\r\n            setStep(step + i)\r\n        }\r\n    }\r\n\r\n    const onChange = obj => {\r\n        let {type, value} = obj\r\n        setInfo(info => ({...info, [type]: value}))\r\n    }\r\n\r\n\r\n    const createRegulations = () => {\r\n        let data = {};\r\n        data.offerId = id;\r\n        data.regulations = info.regulations.filter((item) => item.value).map((item) => item.value? item.title : null)\r\n        data.details = info.details.filter((item) => item.value).map((item) => item.value? item.title : null)\r\n\r\n        setLoading(true)\r\n        apiEditOffer(id, {step: 3})\r\n        setOffer({...offer, step: 3})\r\n        apiOfferRegulations(data)\r\n            .then(res => {\r\n                if (res.err) {\r\n                    setLoading(false)\r\n                    return\r\n                }\r\n                Router.push('/offers/[id]/performance-details', `/offers/${id}/performance-details`, {shallow: true})\r\n            })\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <>\r\n            <Header isReg />\r\n            <Wrapper p={17} pt={35} >\r\n                {offer.id ?\r\n                    <>\r\n                        <ContainerDesktop isOffer>\r\n                            <WrapperHeight>\r\n                                {step === 1 && <LastStep offer={offer} handleChangeStep={handleChangeStep} />}\r\n                            </WrapperHeight>\r\n                        </ContainerDesktop>\r\n\r\n                        {step !== 1 &&\r\n                        <FooterDesktop>\r\n                            <Footer mt={30} flexEnd={step === 1}>\r\n                                {step !== 1 && <Button onClick={() => handleChangeStep(-1)}>Back</Button>}\r\n                                <Button blue\r\n                                        onClick={() => handleChangeStep(1)}\r\n                                        loading={loading}\r\n                                >\r\n                                    Next\r\n                                </Button>\r\n                            </Footer>\r\n                        </FooterDesktop>\r\n                        }\r\n                    </>\r\n                    :\r\n                    <>Loading...</>\r\n                }\r\n\r\n\r\n\r\n            </Wrapper>\r\n        </>\r\n\r\n    );\r\n};\r\nexport default RegulationsPage\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}