{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  @media \", \" {\\n    text-align: center;\\n    button {\\n      width: 200px;\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useContext, useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport styled, { css } from 'styled-components';\nimport { device } from '../../lib/mediaDevice';\nimport { Wrapper, WrapperHeight } from \"../StyledComponents/Wrapper\";\nimport { Button } from \"../controls/Button/Button\";\nimport Photos from '../Offer/photos/Photos';\nimport EditPhoto from '../Photo/EditPhoto';\nimport CoverPhoto from '../Offer/photos/CoverPhoto';\nimport { apiSendProfilePhotos, apiGetProfilePhotos, apiRemoveProfilePhoto, apiSendProfileCoverPhoto } from '../../actions/api';\nimport { showNotification } from \"../../utils/notification\";\nimport '../Offer/photos/photo.css';\n\nvar PhotoGallery = function PhotoGallery(_ref) {\n  var photosArr = _ref.photosArr,\n      coverPhoto = _ref.coverPhoto,\n      isLoading = _ref.isLoading,\n      onSave = _ref.onSave;\n\n  var _useState = useState(2),\n      step = _useState[0],\n      setStep = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      loadingEdit = _useState3[0],\n      setLoadingEdit = _useState3[1];\n\n  var _useState4 = useState(false),\n      uploading = _useState4[0],\n      setUploading = _useState4[1];\n\n  var _useState5 = useState([]),\n      photos = _useState5[0],\n      setPhotos = _useState5[1];\n\n  var _useState6 = useState(['']),\n      videos = _useState6[0],\n      setVideos = _useState6[1];\n\n  var _useState7 = useState(null),\n      cover = _useState7[0],\n      setCover = _useState7[1];\n\n  var _useState8 = useState({}),\n      photoEditable = _useState8[0],\n      setPhotoEditable = _useState8[1];\n\n  var _useState9 = useState(null),\n      keyPhoto = _useState9[0],\n      setKeyPhoto = _useState9[1];\n\n  useEffect(function () {\n    if (photosArr.length) {\n      setPhotos(photosArr);\n    }\n\n    if (coverPhoto && coverPhoto.id) {\n      setCover(coverPhoto.id);\n    }\n  }, []);\n\n  var onSetCover = function onSetCover(id) {\n    setCover(id);\n    setStep(2);\n  };\n\n  var onDrop = function onDrop(files) {\n    // setPhotos([...photos, ...files])\n    onUploadFiles(files);\n  };\n\n  var onUploadFiles = function onUploadFiles(files) {\n    var data, res;\n    return _regeneratorRuntime.async(function onUploadFiles$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            data = new FormData();\n            files.forEach(function (file) {\n              if (!file.id || file.blob) {\n                if (file.blob) {\n                  data.append(\"file\", file.blob, file.name);\n                } else {\n                  data.append(\"file\", file, file.name);\n                }\n              }\n            });\n            setUploading(true);\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(apiSendProfilePhotos(data));\n\n          case 5:\n            res = _context.sent;\n\n            if (res.data) {\n              setPhotos([].concat(_toConsumableArray(photos), _toConsumableArray(res.data)));\n            }\n\n            setUploading(false);\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    });\n  };\n\n  var handleSavePhotos = function handleSavePhotos() {\n    var data;\n    return _regeneratorRuntime.async(function handleSavePhotos$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            data = new FormData();\n            photos.forEach(function (file) {\n              if (!file.id || file.blob) {\n                if (file.blob) {\n                  data.append(\"file\", file.blob, file.name);\n                } else {\n                  data.append(\"file\", file, file.name);\n                }\n              }\n            });\n            handleSendPhotos(data); // setLoading(true)\n            // let photosDeleting = photos.filter((item, key) => (item.blob && item.id))\n            // if(photosDeleting.length) {\n            //     Promise.all(photosDeleting.map(item => handleRemovePhoto(item.id)))\n            //         .then(res => {\n            //             handleSendPhotos(data)\n            //         })\n            // } else {\n            //     handleSendPhotos(data)\n            // }\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    });\n  };\n\n  var handleSendPhotos = function handleSendPhotos(data) {\n    setLoading(true);\n    apiSendProfilePhotos(data).then(function (res) {\n      setLoading(false);\n      var photosFilter = photos.filter(function (item) {\n        return item.id && !item.blob;\n      });\n      setPhotos([].concat(_toConsumableArray(photosFilter), _toConsumableArray(res.data)));\n      var photosNew = [].concat(_toConsumableArray(photosFilter), _toConsumableArray(res.data));\n      apiSendProfileCoverPhoto(cover).then(function (res) {\n        onSave(photosNew, res.data.coverPhoto);\n      });\n      setLoading(false);\n    })[\"catch\"](function (e) {\n      showNotification('error', e);\n      setLoading(false);\n    });\n  };\n\n  var handleEditPhoto = function handleEditPhoto(photo) {\n    var res;\n    return _regeneratorRuntime.async(function handleEditPhoto$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(apiEditOfferPhoto(photo));\n\n          case 2:\n            res = _context3.sent;\n            console.log(res);\n            return _context3.abrupt(\"return\", res);\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    });\n  };\n\n  var handleRemovePhoto = function handleRemovePhoto(id) {\n    var res;\n    return _regeneratorRuntime.async(function handleRemovePhoto$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(apiRemoveProfilePhoto(id));\n\n          case 2:\n            res = _context4.sent;\n            console.log(res);\n            return _context4.abrupt(\"return\", res);\n\n          case 5:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    });\n  };\n\n  var handleDeletePhoto = function handleDeletePhoto(key) {\n    var photoByKey, res, photosClone, _photosClone;\n\n    return _regeneratorRuntime.async(function handleDeletePhoto$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            photoByKey = photos[key];\n\n            if (!photoByKey.id) {\n              _context5.next = 11;\n              break;\n            }\n\n            _context5.next = 4;\n            return _regeneratorRuntime.awrap(handleRemovePhoto(photoByKey.id));\n\n          case 4:\n            res = _context5.sent;\n            photosClone = _toConsumableArray(photos);\n            photosClone.splice(key, 1);\n            setPhotos(photosClone);\n            setStep(2);\n            _context5.next = 15;\n            break;\n\n          case 11:\n            _photosClone = _toConsumableArray(photos);\n\n            _photosClone.splice(key, 1);\n\n            setPhotos(_photosClone);\n            setStep(2);\n\n          case 15:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    });\n  };\n\n  var setEditablePhoto = function setEditablePhoto(photo, key) {\n    setPhotoEditable(photo);\n    setKeyPhoto(key);\n    setStep(4);\n  };\n\n  var handleBackFromEdit = function handleBackFromEdit() {\n    setPhotoEditable({});\n    setKeyPhoto(null);\n    setStep(2);\n  };\n\n  var handleRotate = function handleRotate(blob, url, key) {\n    var photosCopy, ephoto, isCover, data, res, res2;\n    return _regeneratorRuntime.async(function handleRotate$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.prev = 0;\n            photosCopy = _toConsumableArray(photos), ephoto = photosCopy[key], isCover = !!(cover == ephoto.id);\n            setLoadingEdit(true);\n            data = new FormData();\n            data.append(\"file\", blob, blob.name);\n            _context6.next = 7;\n            return _regeneratorRuntime.awrap(apiSendProfilePhotos(data));\n\n          case 7:\n            res = _context6.sent;\n            _context6.next = 10;\n            return _regeneratorRuntime.awrap(apiRemoveProfilePhoto(ephoto.id));\n\n          case 10:\n            res2 = _context6.sent;\n\n            if (isCover) {\n              setCover(res.data[0].id);\n            }\n\n            photosCopy[key] = res.data[0];\n            setPhotos(photosCopy);\n            setLoadingEdit(false);\n            setStep(2);\n            _context6.next = 23;\n            break;\n\n          case 18:\n            _context6.prev = 18;\n            _context6.t0 = _context6[\"catch\"](0);\n            showNotification('error', 'error');\n            setLoadingEdit(false);\n            setStep(2);\n\n          case 23:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, [[0, 18]]);\n  };\n\n  var onChangePhotoDescription = function onChangePhotoDescription(id, value) {\n    var photosClone = _toConsumableArray(photos);\n\n    var key = photosClone.findIndex(function (item) {\n      return item.id === id;\n    });\n    photosClone[key].description = value;\n    setPhotos(photosClone);\n    console.log(key, value);\n  };\n\n  var disabled = loading;\n  return __jsx(React.Fragment, null, __jsx(Wrapper, {\n    p: 17,\n    pt: 35\n  }, !loading ? __jsx(React.Fragment, null, __jsx(WrapperHeight, null, uploading && __jsx(\"div\", {\n    className: \"photo-uploading-router\"\n  }, \" Uploading... \"), step === 2 && __jsx(Photos, {\n    onDrop: onDrop,\n    setStep: setStep,\n    cover: cover,\n    typeDefaultCover: 'coverProfile',\n    photos: photos,\n    setEditablePhoto: setEditablePhoto,\n    isHiddenDeleting: true\n  }), step === 3 && __jsx(CoverPhoto, {\n    photos: photos,\n    setCover: onSetCover,\n    handleBack: handleBackFromEdit,\n    cover: cover\n  }), step === 4 && __jsx(EditPhoto, {\n    keyPhoto: keyPhoto,\n    photo: photoEditable,\n    handleBack: handleBackFromEdit,\n    handleRotate: handleRotate,\n    handleDelete: handleDeletePhoto,\n    onChangePhotoDescription: onChangePhotoDescription,\n    hidedenDescription: true,\n    loadingEdit: loadingEdit\n  })), __jsx(BottomBtnBox, null, !!(step === 2 && photos.length) && __jsx(Button, {\n    green: true,\n    loading: loading,\n    onClick: handleSavePhotos,\n    mt: 70\n  }, \"Save\"))) : __jsx(React.Fragment, null, \"Loading...\")));\n};\n\nexport default PhotoGallery;\nvar BottomBtnBox = styled.div(_templateObject(), device.laptopDesktop);","map":{"version":3,"sources":["D:/4/диплом/webapp — копия/components/Profile/PhotosGallery.js"],"names":["React","useState","useContext","useEffect","Router","useRouter","styled","css","device","Wrapper","WrapperHeight","Button","Photos","EditPhoto","CoverPhoto","apiSendProfilePhotos","apiGetProfilePhotos","apiRemoveProfilePhoto","apiSendProfileCoverPhoto","showNotification","PhotoGallery","photosArr","coverPhoto","isLoading","onSave","step","setStep","loading","setLoading","loadingEdit","setLoadingEdit","uploading","setUploading","photos","setPhotos","videos","setVideos","cover","setCover","photoEditable","setPhotoEditable","keyPhoto","setKeyPhoto","length","id","onSetCover","onDrop","files","onUploadFiles","data","FormData","forEach","file","blob","append","name","res","handleSavePhotos","handleSendPhotos","then","photosFilter","filter","item","photosNew","e","handleEditPhoto","photo","apiEditOfferPhoto","console","log","handleRemovePhoto","handleDeletePhoto","key","photoByKey","photosClone","splice","setEditablePhoto","handleBackFromEdit","handleRotate","url","photosCopy","ephoto","isCover","res2","onChangePhotoDescription","value","findIndex","description","disabled","BottomBtnBox","div","laptopDesktop"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\r\nimport Router, { useRouter } from 'next/router'\r\nimport styled, { css } from 'styled-components'\r\nimport { device } from '../../lib/mediaDevice'\r\nimport {Wrapper, WrapperHeight} from \"../StyledComponents/Wrapper\";\r\nimport {Button} from \"../controls/Button/Button\";\r\nimport Photos from '../Offer/photos/Photos'\r\nimport EditPhoto from '../Photo/EditPhoto'\r\nimport CoverPhoto from '../Offer/photos/CoverPhoto'\r\n\r\nimport {\r\n    apiSendProfilePhotos,\r\n    apiGetProfilePhotos,\r\n    apiRemoveProfilePhoto,\r\n    apiSendProfileCoverPhoto\r\n} from '../../actions/api'\r\nimport {showNotification} from \"../../utils/notification\";\r\n\r\nimport '../Offer/photos/photo.css'\r\n\r\nconst PhotoGallery = ({photosArr, coverPhoto, isLoading, onSave}) => {\r\n    const [step, setStep] = useState(2)\r\n    const [loading, setLoading] = useState(false)\r\n    const [loadingEdit, setLoadingEdit] = useState(false)\r\n    const [uploading, setUploading] = useState(false)\r\n    const [photos, setPhotos] = useState([])\r\n    const [videos, setVideos] = useState([''])\r\n    const [cover, setCover] = useState(null)\r\n    const [photoEditable, setPhotoEditable] = useState({})\r\n    const [keyPhoto, setKeyPhoto] = useState(null)\r\n\r\n    useEffect(() => {\r\n        if(photosArr.length) {\r\n            setPhotos(photosArr)\r\n        }\r\n        if(coverPhoto && coverPhoto.id) {\r\n            setCover(coverPhoto.id)\r\n        }\r\n    }, [])\r\n\r\n\r\n    const onSetCover = id => {\r\n        setCover(id)\r\n        setStep(2)\r\n    }\r\n\r\n    const onDrop = (files) => {\r\n        // setPhotos([...photos, ...files])\r\n        onUploadFiles(files)\r\n    }\r\n    const onUploadFiles = async (files) => {\r\n        let data = new FormData();\r\n        files.forEach(file => {\r\n            if(!file.id || file.blob) {\r\n                if(file.blob) {\r\n                    data.append(\"file\", file.blob, file.name)\r\n                } else {\r\n                    data.append(\"file\", file, file.name)\r\n                }\r\n            }\r\n        });\r\n        setUploading(true)\r\n        let res = await apiSendProfilePhotos(data)\r\n        if(res.data) {\r\n            setPhotos([...photos, ...res.data])\r\n        }\r\n        setUploading(false)\r\n    }\r\n\r\n    const handleSavePhotos = async () => {\r\n        let data = new FormData();\r\n        photos.forEach(file => {\r\n            if(!file.id || file.blob) {\r\n                if(file.blob) {\r\n                    data.append(\"file\", file.blob, file.name)\r\n                } else {\r\n                    data.append(\"file\", file, file.name)\r\n                }\r\n            }\r\n        });\r\n        handleSendPhotos(data)\r\n        // setLoading(true)\r\n        // let photosDeleting = photos.filter((item, key) => (item.blob && item.id))\r\n        // if(photosDeleting.length) {\r\n        //     Promise.all(photosDeleting.map(item => handleRemovePhoto(item.id)))\r\n        //         .then(res => {\r\n        //             handleSendPhotos(data)\r\n        //         })\r\n        // } else {\r\n        //     handleSendPhotos(data)\r\n        // }\r\n    }\r\n\r\n    const handleSendPhotos = data => {\r\n        setLoading(true)\r\n        apiSendProfilePhotos(data)\r\n            .then(res => {\r\n                setLoading(false)\r\n                let photosFilter = photos.filter((item) => {\r\n                    return (item.id && !item.blob)\r\n                })\r\n                setPhotos([...photosFilter, ...res.data])\r\n\r\n                let photosNew = [...photosFilter, ...res.data];\r\n\r\n                apiSendProfileCoverPhoto(cover)\r\n                    .then(res => {\r\n                        onSave(photosNew, res.data.coverPhoto)\r\n                    })\r\n                setLoading(false)\r\n\r\n            })\r\n            .catch(e => {\r\n                showNotification('error', e)\r\n                setLoading(false)\r\n            })\r\n    }\r\n\r\n    const handleEditPhoto = async photo => {\r\n        const res = await apiEditOfferPhoto(photo)\r\n        console.log(res)\r\n        return res\r\n    }\r\n\r\n    const handleRemovePhoto = async id => {\r\n        const res = await apiRemoveProfilePhoto(id)\r\n        console.log(res)\r\n        return res\r\n    }\r\n\r\n    const handleDeletePhoto = async (key) => {\r\n        let photoByKey = photos[key];\r\n        if(photoByKey.id) {\r\n            const res = await handleRemovePhoto(photoByKey.id)\r\n            let photosClone = [...photos]\r\n            photosClone.splice(key, 1)\r\n            setPhotos(photosClone)\r\n            setStep(2)\r\n        } else {\r\n            let photosClone = [...photos]\r\n            photosClone.splice(key, 1)\r\n            setPhotos(photosClone)\r\n            setStep(2)\r\n        }\r\n    }\r\n\r\n    const setEditablePhoto = (photo, key) => {\r\n        setPhotoEditable(photo)\r\n        setKeyPhoto(key)\r\n        setStep(4)\r\n    }\r\n    const handleBackFromEdit = () => {\r\n        setPhotoEditable({})\r\n        setKeyPhoto(null)\r\n        setStep(2)\r\n    }\r\n    const handleRotate = async (blob, url, key) => {\r\n        try {\r\n            let photosCopy = [...photos],\r\n                ephoto = photosCopy[key],\r\n                isCover = !!(cover == ephoto.id)\r\n            setLoadingEdit(true)\r\n            let data = new FormData();\r\n            data.append(\"file\", blob, blob.name)\r\n            let res = await apiSendProfilePhotos(data)\r\n            let res2 = await apiRemoveProfilePhoto(ephoto.id)\r\n            if(isCover) {\r\n                setCover(res.data[0].id)\r\n            }\r\n            photosCopy[key] = res.data[0]\r\n            setPhotos(photosCopy)\r\n            setLoadingEdit(false)\r\n            setStep(2)\r\n        } catch (e) {\r\n            showNotification('error', 'error')\r\n            setLoadingEdit(false)\r\n            setStep(2)\r\n        }\r\n\r\n    }\r\n\r\n    const onChangePhotoDescription = (id, value) => {\r\n        let photosClone = [...photos]\r\n        let key = photosClone.findIndex(item => item.id === id)\r\n        photosClone[key].description = value\r\n        setPhotos(photosClone)\r\n        console.log(key, value)\r\n    }\r\n\r\n    const disabled = loading;\r\n\r\n    return (\r\n        <>\r\n            <Wrapper p={17} pt={35}>\r\n                {!loading ?\r\n                    <>\r\n                        <WrapperHeight>\r\n                            {uploading && <div className='photo-uploading-router'> Uploading... </div>}\r\n\r\n                            {step === 2 &&\r\n                            <Photos\r\n                                onDrop={onDrop}\r\n                                setStep={setStep}\r\n                                cover={cover}\r\n                                typeDefaultCover={'coverProfile'}\r\n                                photos={photos}\r\n                                setEditablePhoto={setEditablePhoto}\r\n                                isHiddenDeleting={true}\r\n                            />\r\n                            }\r\n                            {step === 3 &&\r\n                            <CoverPhoto\r\n                                photos={photos}\r\n                                setCover={onSetCover}\r\n                                handleBack={handleBackFromEdit}\r\n                                cover={cover}\r\n                            />\r\n                            }\r\n                            {step === 4 &&\r\n                            <EditPhoto\r\n                                keyPhoto={keyPhoto}\r\n                                photo={photoEditable}\r\n                                handleBack={handleBackFromEdit}\r\n                                handleRotate={handleRotate}\r\n                                handleDelete={handleDeletePhoto}\r\n                                onChangePhotoDescription={onChangePhotoDescription}\r\n                                hidedenDescription={true}\r\n                                loadingEdit={loadingEdit}\r\n                            />\r\n                            }\r\n\r\n                        </WrapperHeight>\r\n\r\n                        <BottomBtnBox>\r\n                            {!!(step === 2 && photos.length) &&  <Button green loading={loading} onClick={handleSavePhotos} mt={70}>Save</Button>}\r\n                        </BottomBtnBox>\r\n\r\n\r\n\r\n                    </>\r\n                    :\r\n                    <>Loading...</>\r\n                }\r\n\r\n\r\n            </Wrapper>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default PhotoGallery\r\n\r\nconst BottomBtnBox = styled.div`\r\n  @media ${device.laptopDesktop} {\r\n    text-align: center;\r\n    button {\r\n      width: 200px;\r\n    }\r\n  }\r\n`"]},"metadata":{},"sourceType":"module"}