{"ast":null,"code":"import _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport Router from 'next/router';\nimport { apiGetMe, apiGetUnreadMessages, apiJoinToOffer } from '../../actions/api';\nimport cookie from \"js-cookie\";\nimport { urlSearchParams } from \"../../utils/utils\";\nvar token = cookie.get('token');\nvar MainContext = React.createContext({});\nvar MainConsumer = MainContext.Consumer;\n/* Then create a provider Component */\n\nvar MainProvider =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(MainProvider, _Component);\n\n  function MainProvider() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, MainProvider);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(MainProvider)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"getMe\", function () {\n      apiGetMe().then(function (res) {\n        _this.setState({\n          me: res.data,\n          checkedMe: true\n        });\n      })[\"catch\"](function () {\n        Router.push('/login');\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getUnreadMessages\", function () {\n      apiGetUnreadMessages().then(function (res) {\n        _this.setState({\n          unreadMessages: res.data\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setMe\", function (me) {\n      var clone = _Object$assign({}, me);\n\n      _this.setState({\n        me: me\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setOffer\", function (offer) {\n      _this.setState({\n        offer: _Object$assign({}, offer)\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"joinToOffer\", function (ioid) {\n      apiJoinToOffer(ioid).then(function (res) {\n        localStorage.removeItem('ioid');\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleChangeUnreadMessages\", function () {\n      var count = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var unread = _this.state.unreadMessages - count;\n      if (unread < 0) unread = 0;\n\n      _this.setState({\n        unreadMessages: unread\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      me: {},\n      unreadMessages: 0,\n      offer: {\n        categoryOptions: []\n      },\n      checkedMe: false,\n      setMe: _this.setMe,\n      setOffer: _this.setOffer,\n      handleChangeUnreadMessages: _this.handleChangeUnreadMessages,\n      listOffers: []\n    });\n\n    return _this;\n  }\n\n  _createClass(MainProvider, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (token) {\n        this.getMe();\n        this.getUnreadMessages();\n        var ioid = localStorage.getItem('ioid');\n        if (ioid) this.joinToOffer(ioid);\n      } else {\n        this.setState({\n          checkedMe: true\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(MainContext.Provider, {\n        value: this.state\n      }, this.props.children);\n    }\n  }]);\n\n  return MainProvider;\n}(Component); // MainProvider.getInitialProps = async ({ req }) => {\n//     const node_env = process.env.NODE_ENV\n//     console.log('test', node_env)\n//     const host =  req.headers.host\n//     return { node_env }\n// }\n\n\nexport default MainProvider;\nexport { MainConsumer, MainContext };","map":{"version":3,"sources":["D:/4/диплом/webapp/components/contextProviders/MainContext.js"],"names":["React","Component","Router","apiGetMe","apiGetUnreadMessages","apiJoinToOffer","cookie","urlSearchParams","token","get","MainContext","createContext","MainConsumer","Consumer","MainProvider","then","res","setState","me","data","checkedMe","push","unreadMessages","clone","offer","ioid","localStorage","removeItem","count","unread","state","categoryOptions","setMe","setOffer","handleChangeUnreadMessages","listOffers","getMe","getUnreadMessages","getItem","joinToOffer","props","children"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport Router from 'next/router'\r\nimport {apiGetMe, apiGetUnreadMessages, apiJoinToOffer} from '../../actions/api'\r\nimport cookie from \"js-cookie\";\r\nimport {urlSearchParams} from \"../../utils/utils\";\r\nlet token = cookie.get('token')\r\n\r\nconst MainContext = React.createContext({})\r\nconst MainConsumer = MainContext.Consumer\r\n\r\n/* Then create a provider Component */\r\nclass MainProvider extends Component {\r\n    getMe = () => {\r\n        apiGetMe()\r\n            .then((res) => {\r\n                this.setState({me: res.data, checkedMe: true});\r\n            })\r\n            .catch(() => {\r\n                Router.push('/login')\r\n            });\r\n\r\n    };\r\n\r\n    getUnreadMessages = () => {\r\n        apiGetUnreadMessages()\r\n            .then((res) => {\r\n                this.setState({unreadMessages: res.data});\r\n            })\r\n    };\r\n\r\n\r\n\r\n    setMe = me => {\r\n        let clone = Object.assign({}, me);\r\n        this.setState({me: me})\r\n    }\r\n\r\n    setOffer = offer => {\r\n        this.setState({offer: Object.assign({}, offer)})\r\n    }\r\n\r\n    joinToOffer = ioid => {\r\n        apiJoinToOffer(ioid)\r\n            .then(res => {\r\n                localStorage.removeItem('ioid')\r\n            })\r\n    }\r\n\r\n\r\n\r\n    handleChangeUnreadMessages = (count = 0) => {\r\n        let unread  = this.state.unreadMessages - count;\r\n            if(unread < 0) unread = 0;\r\n        this.setState({unreadMessages: unread})\r\n    }\r\n\r\n    state = {\r\n        me: {},\r\n        unreadMessages: 0,\r\n        offer: {\r\n            categoryOptions: []\r\n        },\r\n        checkedMe: false,\r\n        setMe: this.setMe,\r\n        setOffer: this.setOffer,\r\n        handleChangeUnreadMessages: this.handleChangeUnreadMessages,\r\n        listOffers: []\r\n    }\r\n\r\n    componentDidMount() {\r\n        if(token) {\r\n            this.getMe()\r\n            this.getUnreadMessages()\r\n\r\n            let ioid = localStorage.getItem('ioid')\r\n            if(ioid) this.joinToOffer(ioid)\r\n\r\n        } else {\r\n            this.setState({checkedMe: true})\r\n        }\r\n    }\r\n\r\n    render () {\r\n        return (\r\n            <MainContext.Provider value={this.state} >\r\n                {this.props.children}\r\n            </MainContext.Provider>\r\n        )\r\n    }\r\n}\r\n\r\n// MainProvider.getInitialProps = async ({ req }) => {\r\n//     const node_env = process.env.NODE_ENV\r\n//     console.log('test', node_env)\r\n//     const host =  req.headers.host\r\n//     return { node_env }\r\n// }\r\n\r\nexport default MainProvider\r\nexport {MainConsumer, MainContext}\r\n\r\n"]},"metadata":{},"sourceType":"module"}