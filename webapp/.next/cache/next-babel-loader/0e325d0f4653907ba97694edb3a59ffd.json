{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useContext, useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport { Wrapper, WrapperHeight } from \"../../../components/StyledComponents/Wrapper\";\nimport { Footer } from \"../../../components/Layouts/styledLayouts\";\nimport { Button } from \"../../../components/controls/Button/Button\";\nimport Upload from '../../../components/Offer/photos/Upload';\nimport Photos from '../../../components/Offer/photos/Photos';\nimport EditPhoto from '../../../components/Photo/EditPhoto';\nimport CoverPhoto from '../../../components/Offer/photos/CoverPhoto';\nimport Video from '../../../components/Offer/photos/Video';\nimport Header from \"../../../components/Header/Header\";\nimport { apiEditOffer, apiOfferPhotos, apiSetOfferCoverPhoto, apiRemoveOfferPhoto, apiEditOfferPhoto } from '../../../actions/api';\nimport withOfferInfo from \"../../../utils/offer\";\nimport { showNotification } from \"../../../utils/notification\";\nimport useOffer from \"../../../hooks/useOffer\";\nimport '../../../components/Offer/photos/photo.css';\nimport { MainContext } from \"../../../components/contextProviders/MainContext\";\nimport { ContainerDesktop } from \"../../StyledComponents/Grid\";\n\nvar PhotosEdit = function PhotosEdit(_ref) {\n  var offer = _ref.offer,\n      setOffer = _ref.setOffer,\n      isLoading = _ref.isLoading,\n      onSave = _ref.onSave;\n\n  var _useState = useState(2),\n      step = _useState[0],\n      setStep = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      loadingEdit = _useState3[0],\n      setLoadingEdit = _useState3[1];\n\n  var _useState4 = useState(false),\n      isDeletingAll = _useState4[0],\n      setIsDeletingAll = _useState4[1];\n\n  var _useState5 = useState(false),\n      uploading = _useState5[0],\n      setUploading = _useState5[1];\n\n  var _useState6 = useState([]),\n      photos = _useState6[0],\n      setPhotos = _useState6[1];\n\n  var _useState7 = useState(['']),\n      videos = _useState7[0],\n      _setVideos = _useState7[1];\n\n  var _useState8 = useState(null),\n      cover = _useState8[0],\n      setCover = _useState8[1];\n\n  var _useState9 = useState({}),\n      photoEditable = _useState9[0],\n      setPhotoEditable = _useState9[1];\n\n  var _useState10 = useState(null),\n      keyPhoto = _useState10[0],\n      setKeyPhoto = _useState10[1];\n\n  useEffect(function () {\n    if (offer.videoUrl && offer.videoUrl.length) {\n      _setVideos(offer.videoUrl);\n    }\n\n    if (offer.offerPhoto && offer.offerPhoto.length) {\n      setPhotos(offer.offerPhoto);\n      setAvatarId();\n      setStep(2);\n    }\n  }, [offer.id]);\n\n  var setAvatarId = function setAvatarId() {\n    if (!offer.avatarUrl) {\n      setCover(offer.offerPhoto[0].id);\n    } else {\n      var avatar = offer.offerPhoto.find(function (item) {\n        return item.photoUrl === offer.avatarUrl;\n      });\n\n      if (avatar && avatar.id) {\n        setCover(avatar.id);\n      }\n    }\n  };\n\n  var onDrop = function onDrop(files) {\n    // setPhotos([...photos, ...files])\n    // setStep(2)\n    onUploadFiles(files);\n  };\n\n  var onUploadFiles = function onUploadFiles(files) {\n    var data, res;\n    return _regeneratorRuntime.async(function onUploadFiles$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            data = new FormData();\n            data.append(\"offerId\", offer.id);\n            files.forEach(function (file) {\n              if (!file.id || file.blob) {\n                if (file.blob) {\n                  data.append(\"file\", file.blob, file.name);\n                } else {\n                  data.append(\"file\", file, file.name);\n                }\n              }\n            });\n            setUploading(true);\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(apiOfferPhotos(data));\n\n          case 6:\n            res = _context.sent;\n\n            if (res.data) {\n              setPhotos([].concat(_toConsumableArray(photos), _toConsumableArray(res.data)));\n            }\n\n            setUploading(false);\n            setStep(2);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    });\n  };\n\n  var onSetCover = function onSetCover(id) {\n    setCover(id);\n    setStep(2);\n  };\n\n  var handleChangeStep = function handleChangeStep(i) {\n    if (step === 5 && i === -1) {\n      setStep(2);\n      return;\n    }\n\n    if ((step === 1 || step === 2) && i === -1) {\n      Router.push('/offers/[id]/params', \"/offers/\".concat(id, \"/params\"), {\n        shallow: true\n      });\n    } else {\n      setStep(step + i);\n    }\n  };\n\n  var handleSavePhotos = function handleSavePhotos() {\n    var data;\n    return _regeneratorRuntime.async(function handleSavePhotos$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            data = new FormData();\n            data.append(\"offerId\", offer.id);\n            photos.forEach(function (file) {\n              if (!file.id || file.blob) {\n                if (file.blob) {\n                  data.append(\"file\", file.blob, file.name);\n                } else {\n                  data.append(\"file\", file, file.name);\n                }\n              }\n            });\n            handleSendPhotos(data); // let photosDeleting = photos.filter((item, key) => (item.blob && item.id))\n            //\n            // if(photosDeleting.length) {\n            //     Promise.all(photosDeleting.map(item => handleRemovePhoto(item.id)))\n            //         .then(res => {\n            //             handleSendPhotos(data)\n            //         })\n            // } else {\n            //     handleSendPhotos(data)\n            // }\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    });\n  };\n\n  var handleSendPhotos = function handleSendPhotos(data) {\n    //TODO optimaze and don't send if something not changed\n    setLoading(true);\n    var photosWithDesc = photos.filter(function (item) {\n      return item.description;\n    });\n\n    _Promise.all(photosWithDesc.map(function (item) {\n      return handleEditPhoto(item);\n    })).then(function (res) {\n      console.log('res', res);\n    });\n\n    apiOfferPhotos(data).then(function (res) {\n      setLoading(false);\n      var photosFilter = photos.filter(function (item) {\n        return item.id && !item.blob;\n      });\n      setPhotos([].concat(_toConsumableArray(photosFilter), _toConsumableArray(res.data)));\n      var offerPhotos = [].concat(_toConsumableArray(photosFilter), _toConsumableArray(res.data));\n      apiSetOfferCoverPhoto(offer.id, {\n        offerPhotoId: cover\n      }).then(function (res) {\n        setOffer(_objectSpread({}, offer));\n        setOffer(_objectSpread({}, offer, {\n          offerPhoto: offerPhotos,\n          avatarUrl: res.data.avatarUrl\n        }));\n        setLoading(false);\n        onSave();\n      });\n    })[\"catch\"](function (e) {\n      showNotification('error', e);\n      setLoading(false);\n    });\n  };\n\n  var handleEditPhoto = function handleEditPhoto(photo) {\n    var res;\n    return _regeneratorRuntime.async(function handleEditPhoto$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(apiEditOfferPhoto(photo));\n\n          case 2:\n            res = _context3.sent;\n            console.log(res);\n            return _context3.abrupt(\"return\", res);\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    });\n  };\n\n  var handleRemovePhoto = function handleRemovePhoto(id) {\n    var res;\n    return _regeneratorRuntime.async(function handleRemovePhoto$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(apiRemoveOfferPhoto(id));\n\n          case 2:\n            res = _context4.sent;\n            console.log(res);\n            return _context4.abrupt(\"return\", res);\n\n          case 5:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    });\n  };\n\n  var handleDeletePhoto = function handleDeletePhoto(key) {\n    var photoByKey, res, photosClone, _photosClone;\n\n    return _regeneratorRuntime.async(function handleDeletePhoto$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            photoByKey = photos[key];\n\n            if (!photoByKey.id) {\n              _context5.next = 11;\n              break;\n            }\n\n            _context5.next = 4;\n            return _regeneratorRuntime.awrap(handleRemovePhoto(photoByKey.id));\n\n          case 4:\n            res = _context5.sent;\n            photosClone = _toConsumableArray(photos);\n            photosClone.splice(key, 1);\n            setPhotos(photosClone);\n            setStep(2);\n            _context5.next = 15;\n            break;\n\n          case 11:\n            _photosClone = _toConsumableArray(photos);\n\n            _photosClone.splice(key, 1);\n\n            setPhotos(_photosClone);\n            setStep(2);\n\n          case 15:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    });\n  };\n\n  var setEditablePhoto = function setEditablePhoto(photo, key) {\n    setPhotoEditable(photo);\n    setKeyPhoto(key);\n    setStep(4);\n  };\n\n  var handleBackFromEdit = function handleBackFromEdit() {\n    setPhotoEditable({});\n    setKeyPhoto(null);\n    setStep(2);\n  };\n\n  var handleRotate = function handleRotate(blob, url, key) {\n    var photosCopy, ephoto, isCover, data, res;\n    return _regeneratorRuntime.async(function handleRotate$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            photosCopy = _toConsumableArray(photos), ephoto = photosCopy[key], isCover = !!(cover == ephoto.id);\n            setLoadingEdit(true);\n            data = new FormData();\n            data.append(\"offerId\", offer.id);\n            data.append(\"file\", blob, 'filename');\n            _context6.next = 7;\n            return _regeneratorRuntime.awrap(apiOfferPhotos(data));\n\n          case 7:\n            res = _context6.sent;\n\n            if (!(ephoto && ephoto.id)) {\n              _context6.next = 11;\n              break;\n            }\n\n            _context6.next = 11;\n            return _regeneratorRuntime.awrap(handleRemovePhoto(ephoto.id));\n\n          case 11:\n            if (isCover) {\n              setCover(res.data[0].id);\n            }\n\n            photosCopy[key] = res.data[0];\n            setPhotos(photosCopy);\n            setLoadingEdit(false);\n            setStep(2);\n\n          case 16:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    });\n  };\n\n  var onChangePhotoDescription = function onChangePhotoDescription(id, value) {\n    value = value.slice(0, 100);\n\n    var photosClone = _toConsumableArray(photos);\n\n    var key = photosClone.findIndex(function (item) {\n      return item.id === id;\n    });\n    photosClone[key].description = value;\n    setPhotos(photosClone);\n    console.log(key, value);\n  };\n\n  var handleDeleteAll = function handleDeleteAll() {\n    if (window.confirm('Are you sure you want to delete all photos?')) {\n      setIsDeletingAll(true);\n\n      _Promise.all(photos.map(function (item) {\n        return handleRemovePhoto(item.id);\n      })).then(function (res) {\n        setIsDeletingAll(false);\n        setPhotos([]);\n      });\n    }\n  };\n\n  var disabled = loading;\n  return __jsx(React.Fragment, null, __jsx(Wrapper, {\n    p: 17,\n    pt: 35\n  }, offer.id ? __jsx(React.Fragment, null, __jsx(WrapperHeight, null, step === 2 && __jsx(Photos, {\n    onDrop: onDrop,\n    setStep: setStep,\n    cover: cover,\n    photos: photos,\n    setEditablePhoto: setEditablePhoto,\n    handleDeleteAll: handleDeleteAll,\n    isDeletingAll: isDeletingAll,\n    uploading: uploading\n  }), step === 3 && __jsx(CoverPhoto, {\n    photos: photos,\n    setCover: onSetCover,\n    handleBack: handleBackFromEdit,\n    cover: cover\n  }), step === 4 && __jsx(EditPhoto, {\n    keyPhoto: keyPhoto,\n    photo: photoEditable,\n    handleBack: handleBackFromEdit,\n    handleRotate: handleRotate,\n    handleDelete: handleDeletePhoto,\n    onChangePhotoDescription: onChangePhotoDescription,\n    loadingEdit: loadingEdit\n  }), step === 5 && __jsx(Video, {\n    videos: videos,\n    setVideos: function setVideos(videos) {\n      return _setVideos(_toConsumableArray(videos));\n    }\n  })), step === 2 && __jsx(Button, {\n    green: true,\n    loading: loading,\n    onClick: handleSavePhotos,\n    mt: 70\n  }, \"Save\")) : __jsx(React.Fragment, null, \"Loading...\")));\n};\n\nexport default PhotosEdit;","map":{"version":3,"sources":["D:/4/диплом/webapp — копия/components/Offer/edit/Photos.js"],"names":["React","useState","useContext","useEffect","Router","useRouter","Wrapper","WrapperHeight","Footer","Button","Upload","Photos","EditPhoto","CoverPhoto","Video","Header","apiEditOffer","apiOfferPhotos","apiSetOfferCoverPhoto","apiRemoveOfferPhoto","apiEditOfferPhoto","withOfferInfo","showNotification","useOffer","MainContext","ContainerDesktop","PhotosEdit","offer","setOffer","isLoading","onSave","step","setStep","loading","setLoading","loadingEdit","setLoadingEdit","isDeletingAll","setIsDeletingAll","uploading","setUploading","photos","setPhotos","videos","setVideos","cover","setCover","photoEditable","setPhotoEditable","keyPhoto","setKeyPhoto","videoUrl","length","offerPhoto","setAvatarId","id","avatarUrl","avatar","find","item","photoUrl","onDrop","files","onUploadFiles","data","FormData","append","forEach","file","blob","name","res","onSetCover","handleChangeStep","i","push","shallow","handleSavePhotos","handleSendPhotos","photosWithDesc","filter","description","all","map","handleEditPhoto","then","console","log","photosFilter","offerPhotos","offerPhotoId","e","photo","handleRemovePhoto","handleDeletePhoto","key","photoByKey","photosClone","splice","setEditablePhoto","handleBackFromEdit","handleRotate","url","photosCopy","ephoto","isCover","onChangePhotoDescription","value","slice","findIndex","handleDeleteAll","window","confirm","disabled"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\r\nimport Router, { useRouter } from 'next/router'\r\n\r\nimport {Wrapper, WrapperHeight} from \"../../../components/StyledComponents/Wrapper\";\r\nimport {Footer} from \"../../../components/Layouts/styledLayouts\";\r\nimport {Button} from \"../../../components/controls/Button/Button\";\r\nimport Upload from '../../../components/Offer/photos/Upload'\r\nimport Photos from '../../../components/Offer/photos/Photos'\r\nimport EditPhoto from '../../../components/Photo/EditPhoto'\r\nimport CoverPhoto from '../../../components/Offer/photos/CoverPhoto'\r\nimport Video from '../../../components/Offer/photos/Video'\r\nimport Header from \"../../../components/Header/Header\";\r\n\r\nimport {apiEditOffer, apiOfferPhotos, apiSetOfferCoverPhoto, apiRemoveOfferPhoto, apiEditOfferPhoto} from '../../../actions/api'\r\nimport withOfferInfo from \"../../../utils/offer\";\r\nimport {showNotification} from \"../../../utils/notification\";\r\nimport useOffer from \"../../../hooks/useOffer\"\r\n\r\nimport '../../../components/Offer/photos/photo.css'\r\nimport {MainContext} from \"../../../components/contextProviders/MainContext\";\r\nimport {ContainerDesktop} from \"../../StyledComponents/Grid\";\r\n\r\nconst PhotosEdit = ({offer, setOffer, isLoading, onSave}) => {\r\n    const [step, setStep] = useState(2)\r\n    const [loading, setLoading] = useState(false)\r\n    const [loadingEdit, setLoadingEdit] = useState(false)\r\n    const [isDeletingAll, setIsDeletingAll] = useState(false)\r\n    const [uploading, setUploading] = useState(false)\r\n    const [photos, setPhotos] = useState([])\r\n    const [videos, setVideos] = useState([''])\r\n    const [cover, setCover] = useState(null)\r\n    const [photoEditable, setPhotoEditable] = useState({})\r\n    const [keyPhoto, setKeyPhoto] = useState(null)\r\n\r\n    useEffect(() => {\r\n        if(offer.videoUrl && offer.videoUrl.length) {\r\n            setVideos(offer.videoUrl)\r\n        }\r\n        if(offer.offerPhoto && offer.offerPhoto.length) {\r\n            setPhotos(offer.offerPhoto)\r\n            setAvatarId()\r\n            setStep(2)\r\n        }\r\n    }, [offer.id])\r\n\r\n    const setAvatarId = () => {\r\n        if(!offer.avatarUrl) {\r\n            setCover(offer.offerPhoto[0].id)\r\n        } else {\r\n            let avatar = offer.offerPhoto.find(item => item.photoUrl === offer.avatarUrl)\r\n            if(avatar && avatar.id) {\r\n                setCover(avatar.id)\r\n            }\r\n        }\r\n    }\r\n\r\n    const onDrop = (files) => {\r\n        // setPhotos([...photos, ...files])\r\n        // setStep(2)\r\n        onUploadFiles(files)\r\n    }\r\n    const onUploadFiles = async (files) => {\r\n        let data = new FormData();\r\n        data.append(\"offerId\", offer.id);\r\n        files.forEach(file => {\r\n            if(!file.id || file.blob) {\r\n                if(file.blob) {\r\n                    data.append(\"file\", file.blob, file.name)\r\n                } else {\r\n                    data.append(\"file\", file, file.name)\r\n                }\r\n            }\r\n        });\r\n        setUploading(true)\r\n        let res = await apiOfferPhotos(data)\r\n        if(res.data) {\r\n            setPhotos([...photos, ...res.data])\r\n        }\r\n        setUploading(false)\r\n        setStep(2)\r\n    }\r\n    const onSetCover = id => {\r\n        setCover(id)\r\n        setStep(2)\r\n    }\r\n    const handleChangeStep = i => {\r\n        if(step === 5 && i === -1) {\r\n            setStep(2)\r\n            return\r\n        }\r\n        if((step === 1 || step === 2 ) && i === -1) {\r\n            Router.push('/offers/[id]/params', `/offers/${id}/params`, {shallow: true})\r\n        } else {\r\n            setStep(step + i)\r\n        }\r\n    }\r\n    const handleSavePhotos = async () => {\r\n            let data = new FormData();\r\n            data.append(\"offerId\", offer.id);\r\n            photos.forEach(file => {\r\n                if(!file.id || file.blob) {\r\n                    if(file.blob) {\r\n                        data.append(\"file\", file.blob, file.name)\r\n                    } else {\r\n                        data.append(\"file\", file, file.name)\r\n                    }\r\n                }\r\n            });\r\n        handleSendPhotos(data)\r\n\r\n            // let photosDeleting = photos.filter((item, key) => (item.blob && item.id))\r\n            //\r\n            // if(photosDeleting.length) {\r\n            //     Promise.all(photosDeleting.map(item => handleRemovePhoto(item.id)))\r\n            //         .then(res => {\r\n            //             handleSendPhotos(data)\r\n            //         })\r\n            // } else {\r\n            //     handleSendPhotos(data)\r\n            // }\r\n    }\r\n\r\n    const handleSendPhotos = data => {\r\n        //TODO optimaze and don't send if something not changed\r\n\r\n        setLoading(true)\r\n        let photosWithDesc = photos.filter(item => item.description)\r\n        Promise.all(photosWithDesc.map(item => handleEditPhoto(item)))\r\n            .then(res => {\r\n                console.log('res', res)\r\n            })\r\n\r\n        apiOfferPhotos(data)\r\n            .then(res => {\r\n                setLoading(false)\r\n                let photosFilter = photos.filter((item) => {\r\n                    return (item.id && !item.blob)\r\n                })\r\n                setPhotos([...photosFilter, ...res.data])\r\n                let offerPhotos = [...photosFilter, ...res.data]\r\n\r\n                apiSetOfferCoverPhoto(offer.id,{offerPhotoId: cover})\r\n                    .then(res => {\r\n                        setOffer({...offer, })\r\n                        setOffer({...offer, offerPhoto: offerPhotos, avatarUrl: res.data.avatarUrl})\r\n                        setLoading(false)\r\n                        onSave()\r\n                    })\r\n            })\r\n            .catch(e => {\r\n                showNotification('error', e)\r\n                setLoading(false)\r\n            })\r\n    }\r\n\r\n    const handleEditPhoto = async photo => {\r\n        const res = await apiEditOfferPhoto(photo)\r\n        console.log(res)\r\n        return res\r\n    }\r\n\r\n    const handleRemovePhoto = async id => {\r\n        const res = await apiRemoveOfferPhoto(id)\r\n        console.log(res)\r\n        return res\r\n    }\r\n\r\n    const handleDeletePhoto = async (key) => {\r\n        let photoByKey = photos[key];\r\n        if(photoByKey.id) {\r\n            const res = await handleRemovePhoto(photoByKey.id)\r\n            let photosClone = [...photos]\r\n            photosClone.splice(key, 1)\r\n            setPhotos(photosClone)\r\n            setStep(2)\r\n        } else {\r\n            let photosClone = [...photos]\r\n            photosClone.splice(key, 1)\r\n            setPhotos(photosClone)\r\n            setStep(2)\r\n        }\r\n    }\r\n\r\n    const setEditablePhoto = (photo, key) => {\r\n        setPhotoEditable(photo)\r\n        setKeyPhoto(key)\r\n        setStep(4)\r\n    }\r\n    const handleBackFromEdit = () => {\r\n        setPhotoEditable({})\r\n        setKeyPhoto(null)\r\n        setStep(2)\r\n    }\r\n    const handleRotate = async (blob, url, key) => {\r\n        let photosCopy = [...photos],\r\n            ephoto = photosCopy[key],\r\n            isCover = !!(cover == ephoto.id)\r\n\r\n        setLoadingEdit(true)\r\n        let data = new FormData();\r\n        data.append(\"offerId\", offer.id);\r\n        data.append(\"file\", blob, 'filename')\r\n        let res = await apiOfferPhotos(data)\r\n        if(ephoto && ephoto.id) await handleRemovePhoto(ephoto.id)\r\n        if(isCover) {\r\n            setCover(res.data[0].id)\r\n        }\r\n        photosCopy[key] = res.data[0]\r\n        setPhotos(photosCopy)\r\n        setLoadingEdit(false)\r\n        setStep(2)\r\n\r\n    }\r\n\r\n    const onChangePhotoDescription = (id, value) => {\r\n        value = value.slice(0, 100)\r\n        let photosClone = [...photos]\r\n        let key = photosClone.findIndex(item => item.id === id)\r\n        photosClone[key].description = value\r\n        setPhotos(photosClone)\r\n        console.log(key, value)\r\n    }\r\n\r\n    const handleDeleteAll = () => {\r\n        if (window.confirm('Are you sure you want to delete all photos?')) {\r\n            setIsDeletingAll(true)\r\n            Promise.all(photos.map(item => handleRemovePhoto(item.id)))\r\n                .then(res => {\r\n                    setIsDeletingAll(false)\r\n                    setPhotos([])\r\n                })\r\n        }\r\n    }\r\n\r\n\r\n\r\n    const disabled = loading;\r\n\r\n    return (\r\n        <>\r\n            <Wrapper p={17} pt={35}>\r\n                {offer.id ?\r\n                    <>\r\n                        <WrapperHeight>\r\n                            {step === 2 &&\r\n                            <Photos\r\n                                onDrop={onDrop}\r\n                                setStep={setStep}\r\n                                cover={cover}\r\n                                photos={photos}\r\n                                setEditablePhoto={setEditablePhoto}\r\n                                handleDeleteAll={handleDeleteAll}\r\n                                isDeletingAll={isDeletingAll}\r\n                                uploading={uploading}\r\n                            />\r\n                            }\r\n                            {step === 3 &&\r\n                            <CoverPhoto\r\n                                photos={photos}\r\n                                setCover={onSetCover}\r\n                                handleBack={handleBackFromEdit}\r\n                                cover={cover}\r\n                            />\r\n                            }\r\n                            {step === 4 &&\r\n                            <EditPhoto\r\n                                keyPhoto={keyPhoto}\r\n                                photo={photoEditable}\r\n                                handleBack={handleBackFromEdit}\r\n                                handleRotate={handleRotate}\r\n                                handleDelete={handleDeletePhoto}\r\n                                onChangePhotoDescription={onChangePhotoDescription}\r\n                                loadingEdit={loadingEdit}\r\n                            />\r\n                            }\r\n                            {step === 5 && <Video videos={videos} setVideos={(videos) => setVideos([...videos])} />}\r\n                        </WrapperHeight>\r\n\r\n                        {step === 2 &&  <Button green loading={loading} onClick={handleSavePhotos} mt={70}>Save</Button>}\r\n\r\n                    </>\r\n                    :\r\n                    <>Loading...</>\r\n                }\r\n\r\n\r\n            </Wrapper>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default PhotosEdit\r\n"]},"metadata":{},"sourceType":"module"}